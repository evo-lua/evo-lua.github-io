<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/core-concepts">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Overview: Core Concepts | Evo.lua</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://evo-lua.github.io/docs/getting-started/core-concepts"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Overview: Core Concepts | Evo.lua"><meta data-rh="true" name="description" content="Discover the fundamental concepts that differentiate Evo from Lua(JIT)"><meta data-rh="true" property="og:description" content="Discover the fundamental concepts that differentiate Evo from Lua(JIT)"><link data-rh="true" rel="icon" href="/img/caterpillar.png"><link data-rh="true" rel="canonical" href="https://evo-lua.github.io/docs/getting-started/core-concepts"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/getting-started/core-concepts" hreflang="en"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io/docs/getting-started/core-concepts" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.823e5978.css">
<link rel="preload" href="/assets/js/runtime~main.f275ba3e.js" as="script">
<link rel="preload" href="/assets/js/main.64401e31.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Evo.lua</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/docs/category/api">API Overview</a><a class="navbar__item navbar__link" href="/docs/security-policy">Security Policy</a><a class="navbar__item navbar__link" href="/docs/contributing">Contributing</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/evo-lua" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Documentation Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/evo-in-a-nutshell">Introduction: Evo in a Nutshell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/installation">Setup: Installation and Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/core-concepts">Overview: Core Concepts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/background-information">Background Information</a><button aria-label="Toggle the collapsible sidebar category &#x27;Background Information&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/security-policy">Security Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview: Core Concepts</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Overview: Core Concepts</h1><p>Discover the fundamental concepts that differentiate Evo from Lua(JIT)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><p>This introduction assumes you&#x27;ve read through both the <a href="https://www.lua.org/pil/" target="_blank" rel="noopener noreferrer">Lua</a> and <a href="https://luajit.org" target="_blank" rel="noopener noreferrer">LuaJIT</a> docs and are somewhat familiar with Lua programming.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="topics-covered">Topics Covered<a href="#topics-covered" class="hash-link" aria-label="Direct link to Topics Covered" title="Direct link to Topics Covered">​</a></h2><p>We&#x27;ll take a brief look at the most important &quot;new&quot; concepts that you&#x27;ll need to be aware of when working with Evo:</p><ul><li>Asynchronous I/O and the event loop</li><li>Events and callback handlers</li><li>Multithreading vs. asynchronicity</li><li>Coroutines vs. asynchronicity</li></ul><p>If you&#x27;re already familiar with the above, (e.g., from working with NodeJS, Luvit, or other asynchronous runtimes), feel free to skip this.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-io-and-the-event-loop">Asynchronous I/O and the Event Loop<a href="#asynchronous-io-and-the-event-loop" class="hash-link" aria-label="Direct link to Asynchronous I/O and the Event Loop" title="Direct link to Asynchronous I/O and the Event Loop">​</a></h2><p>Evo is designed for asynchronous programming, which allows you to perform multiple tasks concurrently without blocking the main execution thread. This is achieved using an event loop, which schedules and manages I/O operations and other tasks, running them when they&#x27;re ready to execute. This approach is identical to that used by other runtimes, and it uses the exact same mechanism as <a href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking" target="_blank" rel="noopener noreferrer">NodeJS</a> - in fact, it uses the <a href="https://libuv.org/" target="_blank" rel="noopener noreferrer">exact same underlying library</a> to implement this functionality via <a href="https://github.com/luvit/luv" target="_blank" rel="noopener noreferrer">Lua bindings</a> to its API.</p><p>In contrast to synchronous or blocking code, where the execution waits for a task to complete before moving to the next one, asynchronous code can continue executing other tasks while waiting for the completion of a long-running operation. The flipside of this is that it can be more difficult to write, understand, and debug as it frequently involves callbacks, events, or a similar mechanism.</p><p>This overall design completely changes how Lua programs are executed in the background, at least those that use the asynchronous features included with the runtime. The standard <a href="https://github.com/luvit/luv" target="_blank" rel="noopener noreferrer">Lua</a> libraries are synchronous and you can decide for yourself when, where, and to what extent you rely on non-blocking code. Blocking generally inhibits scalability as no other work can complete, but it&#x27;s still available.</p><p>It should be noted that only some workloads benefit from being made asynchronous:</p><ul><li>I/O-bound tasks such as file system access or networking are almost always<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> better done asynchronously</li><li>CPI-bound tasks such as heavy computation work or decompression are almost always <sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> better done synchronously</li></ul><p><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> <em>Almost, because there is overhead for off-loading the work, and it only makes sense when you don&#x27;t need the result to proceed</em></p><p><sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> <em>Almost, because they often require the same CPU time (just on a different thread) and the number of background workers is limited</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="events-and-callbacks">Events and Callbacks<a href="#events-and-callbacks" class="hash-link" aria-label="Direct link to Events and Callbacks" title="Direct link to Events and Callbacks">​</a></h2><p>At the lowest level, there&#x27;s always some sort of callback (or interrupt) mechanism to notify applications of completion events. A &quot;callback&quot; is really just a function that will be called when the given event occurs, such as &quot;your file has been read&quot; or &quot;the client sent some data&quot;. They&#x27;re ubiquitous in languages like JavaScript that are designed to run in an asynchronous environment, but not usually seen in standard Lua. However, in Evo they are also used and there is no &quot;good&quot; way around them (but more on that later).</p><p>To improve the usability of the resulting asynchronous code, Evo uses &quot;events&quot; directly to abstract callbacks where possible. So instead of passing around callback functions everywhere, you instead write event handlers that the runtime calls with specified parameters, allowing your program to handle the asynchronous task as needed. Whenever you see something like this, that&#x27;s an event handler:</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HttpServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">HTTP_REQUEST_FINISHED</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Event handling code goes here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The conventions used are deliberately kept simple:</p><ul><li>Each API namespace or module contains a list of events, as specified in the <a href="/docs/category/api/">API docs</a></li><li>Events are written in capital letters, and every event handler has the same name as the event it handles</li><li>In order to implement an event handler, you just set a function with the given event&#x27;s name</li><li>There are default event handlers (which usually do nothing, except print some debug information)</li><li>Each event handler receives a <code>string</code> containing the event name, and a payload <code>table</code> as its arguments</li></ul><p>The exact contents of the payload table depend on the event used. Native (C++) events are internally translated to this format.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multithreading-and-the-event-loop">Multithreading and the Event Loop<a href="#multithreading-and-the-event-loop" class="hash-link" aria-label="Direct link to Multithreading and the Event Loop" title="Direct link to Multithreading and the Event Loop">​</a></h2><p>There is just one thread of execution in this asynchronous model. You can spawn other threads, and the event loop does internally use a pool of worker threads to complete the scheduled tasks more efficiently, but the basic model of programming is explicitly single-threaded: You do your work in the main Lua thread, and this thread sleeps when there&#x27;s no async work to be done.</p><p>It only wakes up and notifies your program once an event has been triggered. Then, your program resumes: Tthe event loop notifies it via callbacks to handle all the events, before passing control back to the runtime (which checks for new events and goes back to sleep).</p><p>If this seems a bit complicated, give it some time to sink it. As you work with asynchronous code more it&#x27;ll become clearer.</p><p>The key takeway here is that running multiple threads in parallel is a completely different model of execution, with different trade-offs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="coroutines-and-the-event-loop">Coroutines and the Event Loop<a href="#coroutines-and-the-event-loop" class="hash-link" aria-label="Direct link to Coroutines and the Event Loop" title="Direct link to Coroutines and the Event Loop">​</a></h2><p>Lua features a concept called <a href="https://www.lua.org/pil/9.1.html" target="_blank" rel="noopener noreferrer">coroutines</a>, which are lightweight &quot;threads&quot; that can be halted (and resumed) at will.</p><p>They are indeed different from both threads and asynchronous work, but they can be used in Evo, to great effect. It&#x27;s therefore important to understand how they interact with the event loop. Unlike threads, coroutines don&#x27;t execute in parallel, but instead they behave more closely like asynchronous code that is &quot;woken up&quot; by the event loop, then goes back to sleep until more work is available.</p><p>You can, in fact, implement asynchronous code in a coroutine and send it to sleep (by <a href="https://www.lua.org/manual/5.1/manual.html#pdf-coroutine.yield" target="_blank" rel="noopener noreferrer">yielding</a>) until the async work has completed. Once new work is ready, the event loop can <a href="https://www.lua.org/manual/5.1/manual.html#pdf-coroutine.resume" target="_blank" rel="noopener noreferrer">resume</a> your program. This somewhat alleviates the need for callbacks and events.</p><p>In a future version of Evo, this approach may be more prominent, but for the time being you&#x27;ll have to experiment with it for yourself.</p><p>The most important thing to know is that coroutines still execute on the main thread, they just swap the currently-active function.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/evo-lua/evo-lua.github.io/edit/main/docs/getting-started/core-concepts.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Setup: Installation and Usage</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/how-to-guides"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How-to Guides</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#topics-covered" class="table-of-contents__link toc-highlight">Topics Covered</a></li><li><a href="#asynchronous-io-and-the-event-loop" class="table-of-contents__link toc-highlight">Asynchronous I/O and the Event Loop</a></li><li><a href="#events-and-callbacks" class="table-of-contents__link toc-highlight">Events and Callbacks</a></li><li><a href="#multithreading-and-the-event-loop" class="table-of-contents__link toc-highlight">Multithreading and the Event Loop</a></li><li><a href="#coroutines-and-the-event-loop" class="table-of-contents__link toc-highlight">Coroutines and the Event Loop</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021-2023 · Evo.lua authors and contributors</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f275ba3e.js"></script>
<script src="/assets/js/main.64401e31.js"></script>
</body>
</html>
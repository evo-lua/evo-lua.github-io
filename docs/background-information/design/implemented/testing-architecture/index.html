<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-background-information/design/implemented/testing-architecture">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">RFC: Smoke Testing | Evo.lua</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://evo-lua.github.io//docs/background-information/design/implemented/testing-architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RFC: Smoke Testing | Evo.lua"><meta data-rh="true" name="description" content="This document describes the core design of the test suite"><meta data-rh="true" property="og:description" content="This document describes the core design of the test suite"><link data-rh="true" rel="icon" href="/img/caterpillar.png"><link data-rh="true" rel="canonical" href="https://evo-lua.github.io//docs/background-information/design/implemented/testing-architecture"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io//docs/background-information/design/implemented/testing-architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://evo-lua.github.io//docs/background-information/design/implemented/testing-architecture" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.bb6eaaeb.css">
<link rel="preload" href="/assets/js/runtime~main.23af0ef6.js" as="script">
<link rel="preload" href="/assets/js/main.d4ea0e11.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/caterpillar.png" alt="Evo.lua Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Evo.lua</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/evo-lua" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Documentation Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/background-information">Background Information</a><button aria-label="Toggle the collapsible sidebar category &#x27;Background Information&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/design-documents">Design Documents</a><button aria-label="Toggle the collapsible sidebar category &#x27;Design Documents&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/drafts">Drafts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Drafts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/implemented">Implemented</a><button aria-label="Toggle the collapsible sidebar category &#x27;Implemented&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/build-system-rework">RFC: Ninja-based Builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/code-conventions">RFC: Code Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/event-handling">RFC: Event Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/background-information/design/implemented/testing-architecture">RFC: Smoke Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/implemented/unit-test-runner">RFC: Builtin Test Runner</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/background-information/design/template">Template</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/luajit-notes">LuaJIT Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;LuaJIT Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/background-information"><span itemprop="name">Background Information</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/design-documents"><span itemprop="name">Design Documents</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/implemented"><span itemprop="name">Implemented</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">RFC: Smoke Testing</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>RFC: Smoke Testing</h1><p>This document describes the core design of the test suite</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>Smoke tests guard against failures in the unit test runner and related primitives. The test runner can be used to write the rest of the unit tests, providing convenience features and fancier reporting modes. Writing many smoke tests would be painful due to the limited  support that Lua provides for testing, so switching to the test runner ASAP is the main goal.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="first-principles">First Principles<a class="hash-link" href="#first-principles" title="Direct link to heading">​</a></h2><p>A module can only be said to be working if it is tested. But testing too many modules with only primitive Lua builtins is painful. That&#x27;s the tradeoff. I really wanted to find an optimal point where <em>all</em> of the following held true:</p><ul><li>As little code as possible is tested without a proper framework (that makes testing easier) in place</li><li>No code goes untested; this is especially important for the code placed in said testing framework</li><li>Tests cannot use any primitives that they implement for testing their own implementation (cyclic dependencies)</li><li>When the foundation is well-tested, it can then be used to gradually make testing of the remaining modules easier</li></ul><p>In practice this means separating the unit tests into smoke tests and BDD (unit) tests, running one after the other.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mandatory-features">Mandatory Features<a class="hash-link" href="#mandatory-features" title="Direct link to heading">​</a></h2><p>To reduce the PITA factor of unit testing, the implementation should satisfy all of the following:</p><ul><li>Keeping the code as minimal and &quot;stupid&quot; as possible</li><li>Assertions for all common use cases, with useful error reporting</li><li>A test runner that loads files and evaluates the results of running tests</li><li>Reporting in at least two different output formats (to future-proof, since I know TAP and HTML will be needed)</li><li>Concentrating the functionality in as few modules as possible (ideally, just an <code>assertions</code> and <code>bdd</code> library)</li></ul><p>Eventually, the test reporting will have to be extracted. But for the initial prototype, that wasn&#x27;t a requirement.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="smoke-tests">Smoke Tests<a class="hash-link" href="#smoke-tests" title="Direct link to heading">​</a></h2><p>A smoke test is limited by the following restrictions:</p><ul><li>Cannot access any other nonstandard Lua library (and so must rely on the buitin <code>assert</code> function)</li><li>Must test all basic use cases (can skip optional failure modes to reduce the complexity)</li><li>Must give clear feedback about the progress and any errrors that may have occured</li><li>Should be organized such that the code remains readable and well-organized</li></ul><p>I opted to adopt a xunit-style functional organization scheme that helps maintain readability, but doesn&#x27;t scale.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bdd-unit-tests">BDD Unit Tests<a class="hash-link" href="#bdd-unit-tests" title="Direct link to heading">​</a></h2><p>The test runner needs enough primitives to allow implementing a minimal required feature set:</p><ul><li>Supports colored output for reporting test failures (red as a signal color helps detect failed tests at a glance)</li><li>Must allow BDD-style syntax used in legacy tests (<code>describe</code>, <code>it</code>, and setup/teardown functions)</li><li>Can report errors separately from test failures so that they may be saved and/or reported prominently</li><li>Setup and teardown functions can be omitted from the initial prototype to keep it simple</li></ul><p>All of the above should be covered by smoke tests. The test runner can then handle the remaining unit tests.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="see-also">See also<a class="hash-link" href="#see-also" title="Direct link to heading">​</a></h2><p>To read about the thought process behind building a standalone unit test runner in the first place, read this:</p><ul><li><a href="/docs/background-information/design/implemented/unit-test-runner">RFC: Standardized Unit Test Runner</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/background-information/design/implemented/testing-architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/background-information/design/implemented/event-handling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RFC: Event Handling</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/background-information/design/implemented/unit-test-runner"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RFC: Builtin Test Runner</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#first-principles" class="table-of-contents__link toc-highlight">First Principles</a></li><li><a href="#mandatory-features" class="table-of-contents__link toc-highlight">Mandatory Features</a></li><li><a href="#smoke-tests" class="table-of-contents__link toc-highlight">Smoke Tests</a></li><li><a href="#bdd-unit-tests" class="table-of-contents__link toc-highlight">BDD Unit Tests</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See also</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Evo.lua project (authors and contributors).</div></div></div></footer></div>
<script src="/assets/js/runtime~main.23af0ef6.js"></script>
<script src="/assets/js/main.d4ea0e11.js"></script>
</body>
</html>
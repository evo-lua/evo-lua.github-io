# C_Networking

High-level networking primitives for HTTP and WebSocket servers

## Status

<Experimental/>

## Availability

The individual modules in this  namespace are preloaded and can be accessed directly:

```lua
local HttpServer = require("HttpServer")
```

## UUID

Unique identifiers internally refer to each connection (WebSocket client or HTTP request). They're Lua strings in a standard [RFC](https://en.wikipedia.org/wiki/Universally_unique_identifier) format, as generated by the builtin [uuid](/docs/references/api/libraries/uuid) (and [stduuid](/docs/references/api/bindings/stduuid)) libraries. You shouldn't rely on their format however, and treat them as opaque handles.

## WebServerMessage

This is the message format used by the internal WebServer implementation. Lua event handlers receive it as the `payload` data:

* `eventTypeID` is the `enum` value used by the WebServer to identify the type of event (you can probably just ignore it entirely)
* `clientID` is a unique identifier for the request (or client), which may or may not have become invalid by the time you see the event
* `message` is a buffer containing the payload data in an event-specific format (encoded as a `string` value; can be the empty string)

You'll have to make sure the message payload is interpreted correctly based on the event that you wish to handle, and check that the request or client identified by the `clientID` is still valid when you actually process the event (the other end might have disconncted).

<Struct name="WebServerMessage">
<Member name="eventTypeID" type="number"/>
<Member name="clientID" type="string"/>
<Member name="message" type="string"/>
</Struct>

## HttpServer

### Events

##### ASYNC_POLLING_UPDATE

Triggers after the runtime has finished polling the WebServer for updates and processing all deferred (buffered) events.

##### HTTP_CONNECTION_ABORTED

Triggered when a HTTP connection was dropped by the connected peer. UUID handles will be invalid when this happens.

<Function>
<Parameters>
<Parameter name="event" type="string"/>
<Parameter name="payload" type="WebServerMessage"/>
</Parameters>
</Function>

##### HTTP_CONNECTION_WRITABLE

Triggered when a HTTP connection that you have streamed data to (via [StreamResponse](#streamresponse))

##### HTTP_DATA_RECEIVED
##### HTTP_REQUEST_FINISHED
##### HTTP_REQUEST_STARTED
##### UNKNOWN_OR_INVALID_WEBSERVER_EVENT
##### SERVER_STARTED_LISTENING
##### SERVER_STOPPED_LISTENING

### Fields

#### DEFAULT_PORT

The default port that should be used when none has been specified.

### Functions

#### AddRoute
#### GetRegisteredRoutes
#### GetRequestDetails
#### GetRequestEndpoint
#### GetRequestHeader
#### GetRequestHeaders
#### GetRequestMethod
#### GetRequestQuery
#### GetRequestURL
#### HasRequestDetails
#### ProcessDeferredEvents
#### StartListening
#### StopListening
#### SendResponse
#### StreamResponse
#### WriteHeader
#### WriteResponse
#### WriteStatus

## WebSocketServer

### Events

#### ASYNC_POLLING_UPDATE
#### SERVER_STARTED_LISTENING
#### SERVER_STOPPED_LISTENING
#### UNKNOWN_OR_INVALID_WEBSERVER_EVENT
#### WEBSOCKET_CONNECTION_CLOSED
#### WEBSOCKET_CONNECTION_ESTABLISHED
#### WEBSOCKET_MESSAGE_RECEIVED

### Fields

#### DEFAULT_PORT

The default port that should be used when none has been specified.

### Functions

#### BroadcastBinaryMessage
#### BroadcastCompressedTextMessage
#### BroadcastTextMessage
#### GetNumConnectedClients
#### ProcessDeferredEvents
#### SendBinaryMessageToClient
#### SendCompressedTextMessageToClient
#### SendTextMessageToClient
#### SetEchoMode
#### StartListening
#### StopListening

---

### AppendFile

<Blocking/>

Opens the given `filePath` in append mode and writes `contents` to the end of the file.

<Function>
<Parameters>
<Parameter name="filePath" type="string"/>
<Parameter name="contents" type="string"/>
</Parameters>
<Returns>
<Return name="success" type="boolean"/>
</Returns>
</Function>

### Delete

<Blocking/>

Irrevocably removes the file or directory referenced by the given `fileSystemPath`. This operation cannot be undone.

<Function>
<Parameters>
<Parameter name="fileSystemPath" type="string"/>
</Parameters>
<Returns>
<Return name="success" type="boolean"/>
</Returns>
</Function>

### Exists

<Blocking/>

Returns `true` if the given `fileSystemPath` exists (can be accessed in read-only mode), and `false` otherwise.

<Function>
<Parameters>
<Parameter name="fileSystemPath" type="string"/>
</Parameters>
<Returns>
<Return name="isReadableFileSystemEntry" type="boolean"/>
</Returns>
</Function>

### IsDirectory

<Blocking/>

Returns `true` if the given `fileSystemPath` refers to a `directory` type entry, and `false` otherwise.

<Function>
<Parameters>
<Parameter name="fileSystemPath" type="string"/>
</Parameters>
<Returns>
<Return name="isDirectory" type="boolean"/>
</Returns>
</Function>

### IsFile

<Blocking/>

Returns `true` if the given `fileSystemPath` refers to a `file` type entry, and `false` otherwise.

<Function>
<Parameters>
<Parameter name="fileSystemPath" type="string"/>
</Parameters>
<Returns>
<Return name="isFile" type="boolean"/>
</Returns>
</Function>

### MakeDirectory

<Blocking/>

Creates a new directory with the given `directoryPath` if one doesn't already exist. Will not create parent directories automatically.

<Function>
<Parameters>
<Parameter name="directoryPath" type="string"/>
</Parameters>
<Returns>
<Return name="success" type="boolean"/>
</Returns>
</Function>

### MakeDirectoryTree

<Blocking/>

Creates a new directory with the given `directoryPath` if one doesn't already exist. Will create parent directories (recursively) if needed.

<Function>
<Parameters>
<Parameter name="directoryPath" type="string"/>
</Parameters>
<Returns>
<Return name="success" type="boolean"/>
</Returns>
</Function>

### ReadDirectory

<Blocking/>

Reads the contents of the given directory, and returns a list of all files found within it. In recursive mode, the entire directory tree (including nested folders and all of their contained files) will be included. Will process only the root directory otherwise.

The `isFile` flag is always `true` in the current implementation as directories are removed after their contents have been processed.

<Function>
<Parameters>
<Parameter name="directoryPath" type="string"/>
<Parameter name="isRecursiveMode" type="boolean"/>
</Parameters>
<Returns>
<Return name="directoryContents" type="table"/>
</Returns>
</Function>

<Struct name="directoryContents">
<Member name="absolutePath" type="string"/>
<Member name="isFile" type="boolean"/>
</Struct>

### ReadFile

<Blocking/>

Opens the given `filePath` in read-only mode and returns the file contents as a Lua string.

<Function>
<Parameters>
<Parameter name="filePath" type="string"/>
</Parameters>
<Returns>
<Return name="fileContents" type="string"/>
</Returns>
</Function>

### WriteFile

<Blocking/>

Opens the given `filePath` in write mode and writes `contents` to the file. Overwrites the file if it already exists.

<Function>
<Parameters>
<Parameter name="filePath" type="string"/>
<Parameter name="contents" type="string"/>
</Parameters>
<Returns>
<Return name="success" type="boolean"/>
</Returns>
</Function>

## Changelog

| Version |      What happened?       |
| :-----: | :-----------------------: |
| v0.0.3  | Added `MakeDirectoryTree` |
| v0.0.1  |      Initial release      |

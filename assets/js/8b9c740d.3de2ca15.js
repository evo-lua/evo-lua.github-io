"use strict";(self.webpackChunkevo_lua_github_io=self.webpackChunkevo_lua_github_io||[]).push([[4920],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},h=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),d=u(a),p=r,m=d["".concat(s,".").concat(p)]||d[p]||c[p]||i;return a?n.createElement(m,o(o({ref:t},h),{},{components:a})):n.createElement(m,o({ref:t},h))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=a[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},4921:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:300},o="Overview: Core Concepts",l={unversionedId:"getting-started/core-concepts",id:"getting-started/core-concepts",title:"Overview: Core Concepts",description:"Discover the fundamental concepts that differentiate Evo from Lua(JIT)",source:"@site/docs/getting-started/core-concepts.md",sourceDirName:"getting-started",slug:"/getting-started/core-concepts",permalink:"/docs/getting-started/core-concepts",draft:!1,editUrl:"https://github.com/evo-lua/evo-lua.github.io/edit/main/docs/getting-started/core-concepts.md",tags:[],version:"current",sidebarPosition:300,frontMatter:{sidebar_position:300},sidebar:"tutorialSidebar",previous:{title:"Setup: Installation and Usage",permalink:"/docs/getting-started/installation"},next:{title:"Exploring the Evo.lua API",permalink:"/docs/getting-started/layered-architecture"}},s={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Topics Covered",id:"topics-covered",level:2},{value:"Lua Runtime Features",id:"lua-runtime-features",level:2},{value:"PUC Lua and the LuaJIT Compiler",id:"puc-lua-and-the-luajit-compiler",level:3},{value:"Lua Versions and Interoperability",id:"lua-versions-and-interoperability",level:3},{value:"Foreign Function Interface",id:"foreign-function-interface",level:3},{value:"Extended Standard Library",id:"extended-standard-library",level:3},{value:"Asynchronous Execution Model",id:"asynchronous-execution-model",level:2},{value:"Enter the Event Loop",id:"enter-the-event-loop",level:3},{value:"Events and Callbacks",id:"events-and-callbacks",level:3},{value:"Threads and Coroutines",id:"threads-and-coroutines",level:3}],h={toc:u},d="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"overview-core-concepts"},"Overview: Core Concepts"),(0,r.kt)("p",null,"Discover the fundamental concepts that differentiate Evo from Lua(JIT)"),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"This introduction assumes you've read through both the ",(0,r.kt)("a",{parentName:"p",href:"https://www.lua.org/pil/"},"Lua")," and ",(0,r.kt)("a",{parentName:"p",href:"https://luajit.org"},"LuaJIT")," docs and are somewhat familiar with Lua's ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Lua_(programming_language)#Features"},"core features"),"."),(0,r.kt)("h2",{id:"topics-covered"},"Topics Covered"),(0,r.kt)("p",null,"First, we'll start with a general overview of how Evo extends the most commonly-used Lua runtimes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Differences between the official ("PUC") Lua interpreter and LuaJIT'),(0,r.kt)("li",{parentName:"ul"},"Differences between the various Lua versions"),(0,r.kt)("li",{parentName:"ul"},"Interaction between Lua and native (C/C++) libraries"),(0,r.kt)("li",{parentName:"ul"},"What Evo's standard libraries bring to the table")),(0,r.kt)("p",null,"We'll then take a brief look at the most important \"new\" concept that you'll need to be aware of when using Evo - the event loop:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Asynchronous I/O and the event loop"),(0,r.kt)("li",{parentName:"ul"},"Events and callback handlers"),(0,r.kt)("li",{parentName:"ul"},"Multithreading/coroutines and the event loop")),(0,r.kt)("p",null,"If you're already familiar with the above, (e.g., from working with NodeJS, Luvit, or other asynchronous runtimes), feel free to skip this."),(0,r.kt)("h2",{id:"lua-runtime-features"},"Lua Runtime Features"),(0,r.kt)("p",null,"First, let's delve into what using Evo as your runtime for Lua scripts means in practice, compared to other options."),(0,r.kt)("h3",{id:"puc-lua-and-the-luajit-compiler"},"PUC Lua and the LuaJIT Compiler"),(0,r.kt)("p",null,"Lua (the programming language) was created by a team at ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Pontifical_Catholic_University_of_Rio_de_Janeiro"},"PUC"),', who also developed and maintain the "standard" ',(0,r.kt)("inlineCode",{parentName:"p"},"lua")," interpreter. While this is a relatively fast interpreter, as far as interpreted languages go, there is a secondary (independent) re-implementation called ",(0,r.kt)("a",{parentName:"p",href:"https://luajit.org/luajit.html"},"LuaJIT")," that focuses on performance and includes a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Just-in-time_compilation"},"Just-In-Time-Compiler"),", a ",(0,r.kt)("a",{parentName:"p",href:"https://luajit.org/ext_ffi.html"},"low-level interface to interact with C libraries"),", and more."),(0,r.kt)("p",null,"Language-wise, both variants are largely compatible (for caveats, see the next paragraph). But there are some key differences:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'LuaJIT can run in both optimized ("jitted") mode as well as in a much slower "interpreter" mode'),(0,r.kt)("li",{parentName:"ul"},"Interfacing with C libraries is much easier (and faster) when using LuaJIT's foreign function interface")),(0,r.kt)("p",null,"You don't really have to worry about these features if you don't have much experience with Lua, but remember that they exist."),(0,r.kt)("h3",{id:"lua-versions-and-interoperability"},"Lua Versions and Interoperability"),(0,r.kt)("p",null,"There are multiple versions of the Lua programming language; the most widely-used ones are probably 5.1 and 5.4."),(0,r.kt)("p",null,"The Lua team continues developing the language and occasionally releases new versions. However, LuaJIT is based on Lua 5.1. It offers only a selection of 5.2 features, and none that were introduced in later versions. Since Evo embeds LuaJIT, it too uses Lua 5.1 (and parts of 5.2). Due to the minimalism of Lua this isn't usually a problem, but it's worth keeping in mind as there are certain incompatibilities."),(0,r.kt)("p",null,"When in doubt, stick to the ",(0,r.kt)("a",{parentName:"p",href:"https://www.lua.org/manual/5.1/manual.html"},"reference manual")," for Lua 5.1. As for LuaJIT, see the list of supported 5.2 features and other extensions ",(0,r.kt)("a",{parentName:"p",href:"https://luajit.org/extensions.html"},"here"),"."),(0,r.kt)("h3",{id:"foreign-function-interface"},"Foreign Function Interface"),(0,r.kt)("p",null,"Because Lua is designed to be lightweight and easy to embed, it doesn't have a large standard library. As a developer, you're generally expected to \"bring your own standard libraries\" if needed. This (usually) means that you'd be using native C or C++ libraries and call functions inside them from Lua, using its ",(0,r.kt)("a",{parentName:"p",href:"https://www.lua.org/pil/24.html"},"C API"),' and custom "bindings" - that is, glue code to interface between Lua and C.'),(0,r.kt)("p",null,"This process is frequently a lot of work and difficult to get right for beginners (who aren't C programmers). It's also not without overhead. Thankfully, LuaJIT's ",(0,r.kt)("a",{parentName:"p",href:"https://luajit.org/ext_ffi.html"},"Foreign Function Interface (FFI)")," solves both of these problems, though knowledge in C and low-level concepts is still required. Alongside the much-improved performance, this is one of the reasons Evo uses LuaJIT (and not PUC-Lua)."),(0,r.kt)("h3",{id:"extended-standard-library"},"Extended Standard Library"),(0,r.kt)("p",null,"The last piece of the puzzle is still missing: It's the aforementioned (lack of) standard libraries. While a reasonable design decision on paper, the lack of easy-to-use libraries for common programming tasks can make it tricky to write applications that do what they need to in Lua. Most of the time, this problem is solved by whoever is making the application implementing their own Lua/C environment."),(0,r.kt)("p",null,"Widely-known examples following this methodology are Blizzard's ",(0,r.kt)("a",{parentName:"p",href:"https://wowpedia.fandom.com/wiki/World_of_Warcraft_API"},"World of Warcraft API"),", ROBLOX, and ",(0,r.kt)("a",{parentName:"p",href:"https://neovim.io/doc/user/api.html"},"neovim"),'. Evo similarly comes with a set of general-purpose libraries, written in C++ and Lua. It handles all the complexity of integrating third-party C/C++ code and exposing it to scripts, while providing easy-to-use high-level interfaces alongside the more low-level APIs for advanced "super users".'),(0,r.kt)("p",null,"The above means that, when writing Lua applications using Evo as your runtime, you can use all of the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Lua 5.1 standard library (",(0,r.kt)("inlineCode",{parentName:"li"},"string"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"table"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"debug"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"coroutine"),", etc.)"),(0,r.kt)("li",{parentName:"ul"},"LuaJIT extensions (`",(0,r.kt)("inlineCode",{parentName:"li"},"ffi"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"string.buffer"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"jit"),")"),(0,r.kt)("li",{parentName:"ul"},"Any of the Lua libraries that are embedded in the ",(0,r.kt)("inlineCode",{parentName:"li"},"evo")," runtime"),(0,r.kt)("li",{parentName:"ul"},"Any of the C++ library bindings that are embedded in the ",(0,r.kt)("inlineCode",{parentName:"li"},"evo")," runtime"),(0,r.kt)("li",{parentName:"ul"},"Any C library you bring and load yourself (e.g, as a precompiled DLL or .so file)")),(0,r.kt)("p",null,"Of course not all possible libraries are included, so you might still have to write your own. But getting started will likely be much faster."),(0,r.kt)("h2",{id:"asynchronous-execution-model"},"Asynchronous Execution Model"),(0,r.kt)("p",null,"Let's now explore the biggest conceptual difference between Evo and a standalone Lua(JIT) interpreter."),(0,r.kt)("h3",{id:"enter-the-event-loop"},"Enter the Event Loop"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you want a simple introduction to asynchronicity, give ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Introducing"},"this MDN article")," a try. It's for JavaScript, but the concepts are the same.")),(0,r.kt)("p",null,"Evo is designed for ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)"},"asynchronous programming"),", which allows you to perform multiple tasks concurrently without blocking the main execution thread. This is achieved using an event loop, which schedules and manages I/O operations and other tasks, running them when they're ready to execute. This approach is identical to that used by other runtimes, and it uses the exact same mechanism as ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/en/docs/guides/blocking-vs-non-blocking"},"NodeJS")," - in fact, it uses the ",(0,r.kt)("a",{parentName:"p",href:"https://libuv.org/"},"exact same underlying library")," to implement this functionality via ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luvit/luv"},"Lua bindings")," to its API."),(0,r.kt)("p",null,"In contrast to synchronous or blocking code, where the execution waits for a task to complete before moving to the next one, asynchronous code can continue executing other tasks while waiting for the completion of a long-running operation. The flipside of this is that it can be more difficult to write, understand, and debug as it frequently involves callbacks, events, or a similar mechanism."),(0,r.kt)("p",null,"This overall design completely changes how Lua programs are executed in the background, at least those that use the asynchronous features included with the runtime. The standard ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luvit/luv"},"Lua")," libraries are synchronous and you can decide for yourself when, where, and to what extent you rely on non-blocking code. Blocking generally inhibits scalability as no other work can complete, but it's still available."),(0,r.kt)("p",null,"By default, most code will still be blocking. That's no cause for concern, as only long-running tasks benefit from offloading."),(0,r.kt)("h3",{id:"events-and-callbacks"},"Events and Callbacks"),(0,r.kt)("p",null,'At the lowest level, there\'s always some sort of callback (or interrupt) mechanism to notify applications of completion events. A "callback" is really just a function that will be called when the given event occurs, such as "your file has been read" or "the client sent some data". They\'re ubiquitous in languages like JavaScript that are designed to run in an asynchronous environment, but not usually seen in standard Lua. However, in Evo they are also used and there is no "good" way around them (but more on that later).'),(0,r.kt)("p",null,'To improve the usability of the resulting asynchronous code, Evo uses "events" directly to abstract callbacks where possible. So instead of passing around callback functions everywhere, there can be event handlers that the runtime calls with specified parameters, allowing your program to handle the asynchronous task as needed. Whenever you see something like this, that\'s an event handler:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},"local server = HttpServer()\n\nfunction server:HTTP_REQUEST_FINISHED(event, payload)\n    -- Event handling code goes here\nend\n")),(0,r.kt)("p",null,"Here's what you need to know about event handlers in Evo:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("a",{parentName:"li",href:"/docs/category/api/"},"API documentation")," always contains a list of events where they are relevant, so make sure to check there first"),(0,r.kt)("li",{parentName:"ul"},"Events are written in ",(0,r.kt)("inlineCode",{parentName:"li"},"ALL_CAPITAL_LETTERS"),", and each corresponding event handler function should use the same name"),(0,r.kt)("li",{parentName:"ul"},"There are default event handlers which usually do nothing, except print some debug information (to notify you of their presence)"),(0,r.kt)("li",{parentName:"ul"},"In order to implement an event handler, you just set a function with the given event's name and override the default handler"),(0,r.kt)("li",{parentName:"ul"},"Each event handler receives a ",(0,r.kt)("inlineCode",{parentName:"li"},"string")," containing the event name, and a payload ",(0,r.kt)("inlineCode",{parentName:"li"},"table")," as its arguments when it is called")),(0,r.kt)("p",null,"The exact contents of the payload table depend on the event used. Native (C++) events are internally translated to this format."),(0,r.kt)("h3",{id:"threads-and-coroutines"},"Threads and Coroutines"),(0,r.kt)("p",null,"While events do help in many simple cases, they aren't going to make complex sequences of asynchronous code more readable."),(0,r.kt)("p",null,"In order to deal with programs that require this, there are two options. You could spawn separate ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Thread_(computing)"},"threads")," and have them execute in parallel, then eventually process the final result in the main program. Alternatively, you can switch between the different asynchronous portions as needed until all of them have completed. To achieve this in Evo, you can use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luvit/luv/blob/master/docs.md#threading-and-synchronization-utilities"},"libuv threads")," and ",(0,r.kt)("a",{parentName:"p",href:"https://www.lua.org/pil/9.4.html"},"Lua coroutines"),", respectively."),(0,r.kt)("p",null,"But beware - the asynchronous nature of the event loop can cause some unforeseen interactions when using threads and coroutines:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The runtime is strictly single-threaded, so there's no way to share the Lua environment with other threads"),(0,r.kt)("li",{parentName:"ul"},"Asynchronous tasks might be prevented from completing if you spawn more threads than are available in the libuv ",(0,r.kt)("a",{parentName:"li",href:"http://docs.libuv.org/en/v1.x/threadpool.html"},"thread pool")),(0,r.kt)("li",{parentName:"ul"},"You can ",(0,r.kt)("a",{parentName:"li",href:"https://www.lua.org/manual/5.1/manual.html#pdf-coroutine.yield"},"yield")," from a coroutine inside the main thread, but you can't yield from the main thread itself to return to the event loop")),(0,r.kt)("p",null,"For most simple Lua programs none of that will make a difference. Just keep in mind that special care is needed in complex scenarios."))}c.isMDXComponent=!0}}]);